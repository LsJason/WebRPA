export const advancedFeaturesContent = `# 🧠 高级功能

本章介绍流程控制、AI集成、API请求等高级功能。

---

## 🔀 流程控制

### 子流程（模块复用）

将常用的模块组合封装成可复用的子流程，实现模块化和代码复用。

**创建子流程（3步）**：

1. **拖入分组**：从左侧「流程控制」分类拖入「分组」模块到画布
2. **设为子流程**：选中分组，在右侧配置面板开启「设为子流程」开关
3. **命名子流程**：输入子流程名称（如"登录流程"）

分组会变成**绿色边框**，显示「📦 子流程定义」标识。

**在子流程内放置模块**：

1. 拖动分组边缘调整大小
2. 将需要复用的模块拖入分组内部
3. 在分组内部连接这些模块

**调用子流程**：

1. 从左侧「流程控制」分类拖入「调用子流程」模块
2. 在右侧配置面板的下拉列表中选择要调用的子流程
3. 将「调用子流程」模块连接到主流程中

**执行逻辑**：
- 子流程内的模块**不会被主流程直接执行**
- 只有执行到「调用子流程」模块时，才会执行对应分组内的所有模块
- 子流程可以**访问和修改主流程的变量**
- 同一个子流程可以在主流程中**多次调用**

**使用场景**：
- 登录流程复用：多个任务都需要先登录
- 数据采集模板：相同的采集逻辑复用
- 通用操作封装：如翻页、滚动加载等

**示例**：
\`\`\`
画布布局：

┌─────────────────────────────────────┐
│  [子流程分组: 登录流程]              │
│    输入用户名 → 输入密码 → 点击登录   │
└─────────────────────────────────────┘

主流程：
  打开网页 → 调用子流程(登录) → 采集数据 → 导出
\`\`\`

**发布与分享**：
- 导出/发布时子流程自动包含
- 其他用户下载后可直接使用和修改子流程

---

### 定时执行

在指定时间或延迟后执行后续流程，用于创建定时任务。

**定时类型**：

#### 1. 指定时间执行

在设定的日期和时间执行。

| 参数 | 说明 | 示例 |
|------|------|------|
| 执行日期 | 目标日期 | 2024-12-31 |
| 执行时间 | 目标时间 | 09:00 |

**示例**：每天早上9点执行签到
\`\`\`
定时执行：
  类型：指定时间
  日期：2024-12-26
  时间：09:00
  
→ 等待到指定时间后继续执行后续模块
\`\`\`

#### 2. 延迟执行

等待指定时长后执行。

| 参数 | 说明 | 示例 |
|------|------|------|
| 延迟小时 | 等待的小时数 | 1 |
| 延迟分钟 | 等待的分钟数 | 30 |
| 延迟秒数 | 等待的秒数 | 0 |

**示例**：延迟5分钟后执行
\`\`\`
定时执行：
  类型：延迟执行
  延迟分钟：5
  
→ 等待5分钟后继续执行后续模块
\`\`\`

**使用场景**：
- 定时签到、打卡
- 延迟发送消息
- 等待特定时间执行任务
- 避开高峰期执行

**注意事项**：
- 定时执行模块不受超时限制
- 如果目标时间已过，会立即执行
- 工作流停止时会取消等待中的定时任务

---

### 条件判断

根据条件执行不同的分支，实现"如果...则...否则..."的逻辑。

**配置项**：

| 参数 | 说明 | 示例 |
|------|------|------|
| 左值 | 条件左边的值 | \`{价格}\`、\`{状态}\` |
| 运算符 | 比较方式 | ==、!=、>、< 等 |
| 右值 | 条件右边的值 | \`100\`、\`"成功"\` |

**支持的运算符**：

| 运算符 | 说明 | 示例 | 结果 |
|--------|------|------|------|
| == | 等于 | \`{count} == 10\` | count等于10时为真 |
| != | 不等于 | \`{status} != "error"\` | status不是error时为真 |
| > | 大于 | \`{price} > 100\` | price大于100时为真 |
| < | 小于 | \`{age} < 18\` | age小于18时为真 |
| >= | 大于等于 | \`{score} >= 60\` | score大于等于60时为真 |
| <= | 小于等于 | \`{num} <= 0\` | num小于等于0时为真 |
| contains | 包含 | \`{text} contains "关键词"\` | text包含"关键词"时为真 |
| startsWith | 开头是 | \`{url} startsWith "https"\` | url以https开头时为真 |
| endsWith | 结尾是 | \`{file} endsWith ".jpg"\` | file以.jpg结尾时为真 |

**分支连接**：

条件判断模块有两个输出：
- **✓ 真**：条件成立时执行
- **✗ 假**：条件不成立时执行

**示例**：检查登录状态
\`\`\`
条件判断：{登录状态} == "已登录"
  ├─ 真 → 执行签到操作
  └─ 假 → 执行登录操作
\`\`\`

---

### 循环执行

重复执行一段流程。

**循环类型**：

#### 1. 计数循环

执行固定次数。

| 参数 | 说明 |
|------|------|
| 循环次数 | 要执行的次数 |
| 索引变量 | 循环索引的变量名（默认：loop_index） |

**自动创建的变量**：
- \`{loop_index}\`：当前是第几次（从0开始，可自定义名称）

**示例**：翻页采集10页数据
\`\`\`
循环执行 10 次
  ├─ 采集当前页数据
  ├─ 点击下一页
  └─ 等待页面加载

可以用 {loop_index} 知道当前是第几页（0-9）
\`\`\`

#### 2. 条件循环

满足条件时持续执行。

| 参数 | 说明 |
|------|------|
| 循环条件 | 继续循环的条件 |

**示例**：循环直到没有下一页
\`\`\`
条件循环：{有下一页} == true
  ├─ 采集当前页数据
  ├─ 检查是否有下一页
  ├─ 点击下一页
  └─ 等待页面加载
\`\`\`

---

### 遍历列表

对列表中的每个元素执行操作。

**配置项**：

| 参数 | 说明 |
|------|------|
| 数据源变量 | 要遍历的列表变量名（直接填变量名，不加花括号） |
| 循环变量 | 当前元素的变量名（默认：item） |
| 索引变量 | 当前索引的变量名（默认：index） |

**自动创建的变量**：
- \`{item}\`：当前正在处理的元素（可自定义名称）
- \`{index}\`：当前元素的索引（从0开始，可自定义名称）

**示例**：遍历URL列表采集数据
\`\`\`
设置变量：网址列表 = ["url1", "url2", "url3"]

遍历列表：网址列表（注意：直接填变量名，不加花括号）
  ├─ 打开网页：{item}
  ├─ 获取数据
  └─ 打印日志：正在处理第 {index} 个网址
\`\`\`

💡 **提示**：循环变量 \`item\`、\`index\` 会自动出现在变量智能提示中。

---

### 跳出循环 / 继续循环

控制循环的执行流程。

**跳出循环（Break）**：
- 立即结束整个循环
- 跳到循环后面的模块继续执行

**继续循环（Continue）**：
- 跳过本次循环的剩余部分
- 直接进入下一次循环

**示例**：找到目标后停止
\`\`\`
遍历列表：商品列表（直接填变量名）
  ├─ 条件判断：{item[price]} < 100
  │   ├─ 真 → 设置变量：找到的商品 = {item}
  │   │       跳出循环
  │   └─ 假 → 继续循环
\`\`\`

---

## 🤖 AI大脑

调用AI大模型处理文本，让工作流更智能。

### 支持的模型

| 提供商 | 模型 | API地址 |
|--------|------|---------|
| OpenAI | gpt-3.5-turbo、gpt-4 | https://api.openai.com/v1 |
| 智谱AI | glm-4、glm-3-turbo | https://open.bigmodel.cn/api/paas/v4 |
| Deepseek | deepseek-chat | https://api.deepseek.com/v1 |
| 月之暗面 | moonshot-v1-8k | https://api.moonshot.cn/v1 |
| 其他 | 兼容OpenAI接口的模型 | 自定义 |

### 配置说明

| 参数 | 说明 | 示例 |
|------|------|------|
| API地址 | 模型接口地址 | https://api.openai.com/v1 |
| API密钥 | 你的API Key | sk-xxx... |
| 模型名称 | 要使用的模型 | gpt-3.5-turbo |
| 系统提示词 | 设定AI的角色和行为 | 你是一个数据分析专家 |
| 用户消息 | 发送给AI的内容 | 请分析以下数据：{数据} |
| 保存到变量 | 存储AI回复的变量名 | AI回复 |
| 温度 | 创造性程度（0-1） | 0.7 |

### 系统提示词技巧

**角色设定**：
\`\`\`
你是一个专业的商品评论分析师，擅长从评论中提取关键信息。
\`\`\`

**输出格式**：
\`\`\`
请以JSON格式输出，包含以下字段：
- sentiment: 情感（正面/负面/中性）
- keywords: 关键词列表
- summary: 一句话总结
\`\`\`

**限制条件**：
\`\`\`
请只输出JSON，不要有其他解释文字。
回答要简洁，不超过100字。
\`\`\`

### 实用场景

#### 1. 文章摘要
\`\`\`
系统提示词：你是一个文章摘要专家，请用3句话总结文章要点。
用户消息：{文章内容}
\`\`\`

#### 2. 情感分析
\`\`\`
系统提示词：分析以下评论的情感倾向，只回答：正面、负面或中性
用户消息：{评论内容}
\`\`\`

#### 3. 数据提取
\`\`\`
系统提示词：从文本中提取联系方式，以JSON格式输出：{"phone": "", "email": ""}
用户消息：{网页文本}
\`\`\`

#### 4. 内容生成
\`\`\`
系统提示词：你是一个营销文案专家
用户消息：请为以下商品写一段50字的推广文案：{商品信息}
\`\`\`

---

## 👁️ AI视觉

调用视觉理解模型分析图片内容。

### 支持的模型

| 提供商 | 模型 | 说明 |
|--------|------|------|
| 智谱AI | glm-4v-flash | 免费，推荐 |
| 智谱AI | glm-4v | 付费，更强 |
| OpenAI | gpt-4-vision-preview | 付费 |

### 图片来源

| 来源 | 说明 | 使用场景 |
|------|------|----------|
| 元素截图 | 截取指定元素的图片 | 验证码识别 |
| 页面截图 | 截取整个页面 | 页面分析 |
| 图片URL | 网络图片地址 | 分析在线图片 |
| 变量 | Base64编码或本地路径 | 使用之前保存的图片 |

### 配置说明

| 参数 | 说明 |
|------|------|
| API地址 | 视觉模型接口地址 |
| API密钥 | API Key |
| 模型名称 | 如 glm-4v-flash |
| 图片来源 | 选择图片获取方式 |
| 提示词 | 告诉AI要做什么 |
| 保存到变量 | 存储识别结果 |

### 实用场景

#### 1. 验证码识别
\`\`\`
图片来源：元素截图
选择器：#captcha-img
提示词：请识别图片中的验证码，只输出验证码字符，不要其他内容
\`\`\`

#### 2. 商品图片分析
\`\`\`
图片来源：图片URL
URL：{商品图片链接}
提示词：描述这个商品的外观特征，包括颜色、材质、风格
\`\`\`

#### 3. 图表数据提取
\`\`\`
图片来源：元素截图
选择器：.chart-container
提示词：提取图表中的数据，以JSON格式输出
\`\`\`

---

## 🌐 API请求

发送HTTP请求，与外部服务交互。

### 请求方法

| 方法 | 用途 |
|------|------|
| GET | 获取数据 |
| POST | 提交数据 |
| PUT | 更新数据 |
| DELETE | 删除数据 |
| PATCH | 部分更新 |

### 配置说明

| 参数 | 说明 | 示例 |
|------|------|------|
| URL | 请求地址 | https://api.example.com/data |
| 方法 | HTTP方法 | GET、POST等 |
| 请求头 | HTTP头部 | {"Authorization": "Bearer xxx"} |
| 请求体 | POST/PUT的数据 | {"name": "test"} |
| 保存到变量 | 存储响应结果 | 响应数据 |

### 请求头设置

常用请求头：
\`\`\`json
{
  "Content-Type": "application/json",
  "Authorization": "Bearer {token}",
  "User-Agent": "Mozilla/5.0"
}
\`\`\`

### 请求体格式

JSON格式：
\`\`\`json
{
  "username": "{用户名}",
  "password": "{密码}",
  "data": {数据}
}
\`\`\`

### 使用响应数据

API响应通常是JSON格式，保存到变量后可以这样访问：

\`\`\`
假设响应：{"code": 200, "data": {"name": "test", "items": [1,2,3]}}

{响应[code]}           → 200
{响应[data][name]}     → test
{响应[data][items][0]} → 1
\`\`\`

### 实用示例

#### 1. 获取天气
\`\`\`
URL: https://api.weather.com/v1/current?city={城市}
方法: GET
保存到: 天气数据

然后使用：{天气数据[temperature]}°C
\`\`\`

#### 2. 发送通知
\`\`\`
URL: https://api.pushplus.plus/send
方法: POST
请求体: {
  "token": "{推送token}",
  "title": "价格提醒",
  "content": "{商品名} 降价到 {价格} 元了！"
}
\`\`\`

#### 3. 提交表单数据
\`\`\`
URL: https://api.example.com/submit
方法: POST
请求头: {"Content-Type": "application/json"}
请求体: {
  "name": "{姓名}",
  "email": "{邮箱}",
  "message": "{留言内容}"
}
\`\`\`

---

## 📧 发送邮件

自动发送邮件通知。

### 配置说明

| 参数 | 说明 | 示例 |
|------|------|------|
| SMTP服务器 | 邮件服务器地址 | smtp.qq.com |
| 端口 | 服务器端口 | 465（SSL）或 587（TLS） |
| 发件人邮箱 | 你的邮箱地址 | xxx@qq.com |
| 授权码 | SMTP授权码 | 不是登录密码！ |
| 收件人 | 目标邮箱 | 多个用逗号分隔 |
| 主题 | 邮件标题 | 支持变量 |
| 内容 | 邮件正文 | 支持变量和HTML |

### 获取QQ邮箱授权码

1. 登录 [QQ邮箱网页版](https://mail.qq.com)
2. 点击 **设置** → **账户**
3. 找到 **POP3/IMAP/SMTP/Exchange/CardDAV/CalDAV服务**
4. 开启 **POP3/SMTP服务**
5. 按提示发送短信验证
6. 获得16位授权码

### 常用SMTP服务器

| 邮箱 | 服务器 | SSL端口 | TLS端口 |
|------|--------|---------|---------|
| QQ邮箱 | smtp.qq.com | 465 | 587 |
| 163邮箱 | smtp.163.com | 465 | 25 |
| Gmail | smtp.gmail.com | 465 | 587 |
| Outlook | smtp.office365.com | - | 587 |

### 邮件内容示例

\`\`\`
主题：【价格监控】{商品名} 降价提醒

内容：
您关注的商品价格有变动：

商品名称：{商品名}
原价：{原价} 元
现价：{现价} 元
降价幅度：{降幅}%

点击查看：{商品链接}

---
此邮件由Web RPA自动发送
\`\`\`

---

## 📥 下载文件

从网页下载文件到本地。

### 下载模式

| 模式 | 说明 | 使用场景 |
|------|------|----------|
| 点击下载 | 点击下载按钮触发下载 | 需要登录或有权限验证的下载 |
| URL下载 | 直接通过URL下载 | 已知文件直链地址 |

### 点击下载模式

**配置项**：

| 参数 | 说明 | 示例 |
|------|------|------|
| 选择器 | 下载按钮的选择器 | \`#download-btn\` |
| 保存目录 | 文件保存的文件夹 | \`C:/Downloads\` |
| 自定义文件名 | 可选，指定文件名 | \`report.pdf\` |

### URL下载模式

**配置项**：

| 参数 | 说明 | 示例 |
|------|------|------|
| 文件URL | 文件的下载地址 | \`https://example.com/file.pdf\` |
| 保存目录 | 文件保存的文件夹 | \`C:/Downloads\` |
| 自定义文件名 | 可选，指定文件名 | \`{日期}_report.pdf\` |

**路径选择**：点击保存目录输入框右侧的 📁 按钮可以通过资源管理器选择文件夹

---

## 📋 剪贴板操作

### 设置剪贴板

将文本或图片设置到系统剪贴板。

**配置项**：

| 参数 | 说明 | 示例 |
|------|------|------|
| 内容类型 | 文本或图片 | text / image |
| 文本内容 | 要复制的文本 | \`{数据}\`，支持变量 |
| 图片路径 | 图片文件路径 | \`C:/images/pic.png\` |

**使用场景**：
- 复制数据到剪贴板供其他程序使用
- 配合键盘操作实现粘贴图片到输入框
- 跨应用数据传递

**示例**：粘贴图片到聊天输入框
\`\`\`
1. 设置剪贴板：图片路径 = C:/images/screenshot.png
2. 点击聊天输入框
3. 键盘操作：Ctrl+V
\`\`\`

---

## ⌨️ 键盘操作

模拟键盘按键和快捷键操作。

**配置项**：

| 参数 | 说明 | 示例 |
|------|------|------|
| 按键组合 | 要按下的键 | \`Ctrl+V\`、\`Enter\`、\`Tab\` |

**支持的按键**：

| 类型 | 按键 |
|------|------|
| 修饰键 | Ctrl、Alt、Shift、Meta（Win键） |
| 功能键 | Enter、Tab、Escape、Backspace、Delete |
| 方向键 | ArrowUp、ArrowDown、ArrowLeft、ArrowRight |
| 其他 | Home、End、PageUp、PageDown、Space |
| 字母数字 | a-z、0-9 |

**常用快捷键示例**：

| 快捷键 | 功能 |
|--------|------|
| Ctrl+A | 全选 |
| Ctrl+C | 复制 |
| Ctrl+V | 粘贴 |
| Ctrl+Z | 撤销 |
| Ctrl+Enter | 发送消息（部分应用） |
| Tab | 切换焦点 |
| Enter | 确认/提交 |
| Escape | 取消/关闭 |

**使用场景**：
- 粘贴剪贴板中的图片
- 提交表单
- 快捷键操作
- 模拟用户键盘输入

---

## 💻 执行JavaScript

在页面中执行自定义JavaScript代码。

### 基础用法

\`\`\`javascript
// 返回值会保存到指定变量
return document.title;
\`\`\`

### 常用示例

**获取页面信息**：
\`\`\`javascript
return {
  title: document.title,
  url: window.location.href,
  scrollHeight: document.body.scrollHeight
};
\`\`\`

**获取所有链接**：
\`\`\`javascript
return Array.from(document.querySelectorAll('a'))
  .map(a => ({text: a.textContent, href: a.href}));
\`\`\`

**修改页面元素**：
\`\`\`javascript
document.querySelector('#element').style.display = 'block';
\`\`\`

**滚动操作**：
\`\`\`javascript
window.scrollTo({top: 1000, behavior: 'smooth'});
\`\`\`

**等待元素**：
\`\`\`javascript
await new Promise(resolve => {
  const check = () => {
    if (document.querySelector('#target')) resolve();
    else setTimeout(check, 100);
  };
  check();
});
return true;
\`\`\`

---

## 🔔 用户输入

在工作流执行过程中弹出对话框，让用户输入数据。

### 配置说明

| 参数 | 说明 |
|------|------|
| 提示文字 | 显示给用户的提示 |
| 默认值 | 输入框的默认内容 |
| 保存到变量 | 存储用户输入的变量名 |

### 使用场景

- 输入验证码
- 输入动态密码
- 确认操作
- 输入搜索关键词

---

## ⏸️ 暂停执行

暂停工作流执行，等待用户手动继续。

### 使用场景

- 需要人工检查
- 等待外部操作完成
- 调试断点

---

## 🔀 并行执行

当一个模块有多条输出连线时，这些分支会**真正并行执行**，大幅提高工作流效率。

### 工作原理

\`\`\`
        ┌─→ 分支A（并行）─┐
模块 ──┼─→ 分支B（并行）─┼─→ 汇合点
        └─→ 分支C（并行）─┘
\`\`\`

系统使用异步执行引擎，当检测到多个分支时会自动并行执行，所有分支完成后才继续执行汇合点后的模块。

### 核心特性

| 特性 | 说明 |
|------|------|
| **真正并行** | 基于异步架构，分支真正同时执行，不是伪并行 |
| **自动检测** | 无需配置，系统自动识别并行分支 |
| **智能汇合** | 多个分支汇合到同一节点时，等待所有分支完成 |
| **线程安全** | 变量操作使用异步锁保护，避免竞争条件 |
| **无限制** | 不限制并行分支数量 |

### 适用场景

#### 1. 并行API请求
\`\`\`
开始
  ├─→ 请求API-A（获取用户信息）
  ├─→ 请求API-B（获取订单列表）
  └─→ 请求API-C（获取商品数据）
      ↓
  汇合：合并所有数据
\`\`\`

#### 2. 并行发送通知
\`\`\`
任务完成
  ├─→ 发送邮件通知
  ├─→ 发送微信推送
  └─→ 写入日志文件
\`\`\`

#### 3. 并行文件处理
\`\`\`
获取文件列表
  ├─→ 下载文件1
  ├─→ 下载文件2
  └─→ 下载文件3
\`\`\`

#### 4. 循环内并行
\`\`\`
遍历商品列表
  └─ 每次循环内：
      ├─→ 获取价格
      ├─→ 获取库存
      └─→ 获取评价
          ↓
      汇合：保存商品数据
\`\`\`

### 汇合机制

当多个分支连接到同一个后续节点时，系统会自动等待所有前驱分支完成：

\`\`\`
分支A ──┐
分支B ──┼─→ 汇合节点（等待A、B、C都完成）
分支C ──┘
\`\`\`

日志中会显示：\`⏳ 等待汇合: 还有 X 个前驱分支未完成\`

### ⚠️ 注意事项

| 注意点 | 说明 | 建议 |
|--------|------|------|
| 浏览器操作 | 并行分支共享同一个浏览器页面 | 浏览器操作建议顺序执行 |
| 变量修改 | 多分支同时修改同一变量可能冲突 | 每个分支使用独立变量 |
| 执行顺序 | 并行分支完成顺序不确定 | 不要依赖特定完成顺序 |
| 错误处理 | 一个分支失败不影响其他分支 | 每个分支独立处理错误 |

### 最佳实践

**✅ 推荐并行的操作**：
- API请求（各自独立的网络请求）
- 文件读写（不同文件）
- 数据计算（无依赖的计算）
- 发送通知（邮件、推送等）
- AI调用（独立的AI请求）
- 数据库操作（独立的查询/插入）

**❌ 不推荐并行的操作**：
- 同一页面的多个浏览器操作
- 有先后依赖的数据处理
- 需要按顺序执行的步骤
- 修改同一个变量的操作

### 性能对比

**顺序执行**：
\`\`\`
API-A(2秒) → API-B(3秒) → API-C(2秒)
总耗时 = 2 + 3 + 2 = 7秒
\`\`\`

**并行执行**：
\`\`\`
      ┌─→ API-A(2秒) ─┐
开始 ─┼─→ API-B(3秒) ─┼─→ 完成
      └─→ API-C(2秒) ─┘
总耗时 = max(2, 3, 2) = 3秒
\`\`\`

**性能提升**：(7-3)/7 ≈ **57%**

### 调试技巧

1. **查看日志**：并行执行时会显示 \`🔀 检测到 X 个分支，并行执行...\`
2. **汇合等待**：汇合时显示 \`⏳ 等待汇合: 还有 X 个前驱分支未完成\`
3. **完成提示**：所有分支完成后显示 \`🔀 X 个分支执行完成\`

---

## 🗄️ 数据库操作

Web RPA 支持连接 MySQL 数据库进行增删改查操作。详细内容请参阅 **🗄️ 数据库操作** 章节。

### 快速概览

| 模块 | 功能 |
|------|------|
| 连接数据库 | 建立MySQL连接 |
| 查询数据 | SELECT查询 |
| 执行SQL | 执行任意SQL语句 |
| 插入数据 | INSERT操作 |
| 更新数据 | UPDATE操作 |
| 删除数据 | DELETE操作 |
| 关闭连接 | 断开数据库连接 |

### 典型流程

\`\`\`
连接数据库 → 执行操作 → 关闭连接
\`\`\`

### 使用场景

- 采集数据直接入库
- 从数据库读取配置
- 数据同步和更新
- 定时清理过期数据`
